version: '3.8'

services:
  db:
    image: mysql:8.0 # Use a specific MySQL version
    container_name: mysql_db
    restart: always
    environment:
      MYSQL_ROOT_PASSWORD: your_root_password
      MYSQL_DATABASE: django_db
      MYSQL_USER: django_user
      MYSQL_PASSWORD: django_password
    ports:
      - "3306:3306"
    volumes:
      - db_data:/var/lib/mysql # Persist database data

  django:
    build: ./django # Build from the django/ directory with a Dockerfile
    container_name: django_app
    command: sh -c "python manage.py migrate && python manage.py runserver 0.0.0.0:8000" # Run migrations and then start the app
    volumes:
      - ./django:/app # Mount your project code
    ports:
      - "8000:8000"
    depends_on:
      - db # Ensure the database starts first
    environment:
      DATABASE_HOST: mysql_db # Use the service name as the hostname
      DATABASE_NAME: django_db
      DATABASE_USER: django_user
      DATABASE_PASSWORD: django_password

  phpmyadmin:
    image: phpmyadmin/phpmyadmin
    environment:
      PMA_HOST: db # Connect to the 'db' service name
      MYSQL_ROOT_PASSWORD: your_root_password
    ports:
      - "8081:80" # Access phpMyAdmin at http://localhost:8081
    #networks:
    #  - app-network
    depends_on:
      - db

#  apache:
#    image: httpd:2.4 # Use an Apache base image
#    container_name: apache_web
#    ports:
#      - "80:80" # Map host port 80 to container port 80
#    volumes:
#      - ./django/static:/usr/local/apache2/htdocs/static # Mount Django static files
#      - ./apache/apache2.conf:/usr/local/apache2/conf/apache2.conf # Custom Apache config
#      - ./apache/000-default.conf:/usr/local/apache2/conf/sites-enabled/000-default.conf # Virtual host config
#    depends_on:
#      - django # Ensure Django app is running

volumes:
  db_data:
